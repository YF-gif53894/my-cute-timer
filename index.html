<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‹ã‚ã„ã„ã‚¿ã‚¤ãƒãƒ¼ï¼ˆé€šçŸ¥ä»˜ãï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fce7f3; }
        .fluffy-button { transition: all 0.1s; box-shadow: 0 4px 0 0 #d946ef; }
        .fluffy-button:active { box-shadow: 0 0 0 0 #d946ef; transform: translateY(4px); }
        .timer-display-card { background-color: #fff; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .timer-font { font-family: 'Varela Round', sans-serif; font-variant-numeric: tabular-nums; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-pink-50 p-6 sm:p-10 rounded-3xl shadow-xl timer-display-card">
        
        <h1 class="text-4xl font-bold text-center text-purple-600 mb-6">
            ğŸ§¸ ãµã‚ã‚¿ã‚¤ãƒãƒ¼ ğŸ’–
        </h1>
        
        <div id="timerDisplay" class="timer-font text-7xl sm:text-9xl font-extrabold text-purple-700 bg-pink-200 p-8 sm:p-12 rounded-2xl mb-8 border-4 border-pink-400 select-none flex items-center justify-center leading-none h-40 sm:h-56">
            00:00
        </div>

        <div id="inputArea" class="flex justify-center space-x-4 mb-8">
            <input type="number" id="minutesInput" placeholder="åˆ†" min="0" value="0"
                   class="w-1/3 p-3 rounded-lg border-2 border-purple-300 focus:border-purple-500 text-center text-lg">
            <input type="number" id="secondsInput" placeholder="ç§’" min="0" max="59" value="0"
                   class="w-1/3 p-3 rounded-lg border-2 border-purple-300 focus:border-purple-500 text-center text-lg">
        </div>

        <div class="flex flex-wrap justify-center gap-4">
            <button id="startButton" class="fluffy-button w-full sm:w-auto flex-grow bg-purple-400 hover:bg-purple-500 text-white font-bold py-3 px-6 rounded-xl">
                ğŸš€ ã‚¹ã‚¿ãƒ¼ãƒˆ
            </button>
            <button id="pauseButton" disabled class="fluffy-button w-full sm:w-auto flex-grow bg-yellow-400 hover:bg-yellow-500 text-purple-800 font-bold py-3 px-6 rounded-xl opacity-50">
                â¸ï¸ ãƒãƒ¼ã‚º
            </button>
            <button id="resetButton" class="fluffy-button w-full sm:w-auto flex-grow bg-pink-400 hover:bg-pink-500 text-white font-bold py-3 px-6 rounded-xl">
                ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
            </button>
        </div>

        <div class="mt-6 flex justify-center items-center gap-2 text-purple-700">
            <input type="checkbox" id="soundCheck" checked class="w-5 h-5 accent-purple-500">
            <label for="soundCheck" class="font-medium cursor-pointer">ğŸ”Š éŸ³ã‚’é³´ã‚‰ã™</label>
        </div>

        <div id="messageBox" class="mt-8 p-4 bg-purple-100 text-purple-700 rounded-xl text-center font-medium hidden"></div>

    </div>

    <script>
        const timerDisplay = document.getElementById('timerDisplay');
        const minutesInput = document.getElementById('minutesInput');
        const secondsInput = document.getElementById('secondsInput');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const resetButton = document.getElementById('resetButton');
        const messageBox = document.getElementById('messageBox');
        const inputArea = document.getElementById('inputArea');
        const soundCheck = document.getElementById('soundCheck');

        let intervalId = null;
        let remainingTime = 0;
        let isRunning = false;
        let isPaused = false;
        let audioCtx = null;

        // éŸ³å£°ã®æº–å‚™
        function initAudio() {
            try {
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
            } catch (e) {
                console.warn("Audio init failed", e);
            }
        }

        // é€šçŸ¥ã®è¨±å¯ã‚’ã‚‚ã‚‰ã†é–¢æ•°
        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                console.log("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯é€šçŸ¥ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
                return;
            }
            if (Notification.permission === "default") {
                Notification.requestPermission();
            }
        }

        // å®Ÿéš›ã«é€šçŸ¥ã‚’å‡ºã™é–¢æ•°
        function showNotification() {
            if (Notification.permission === "granted") {
                const notification = new Notification("ğŸ§¸ ãµã‚ã‚¿ã‚¤ãƒãƒ¼", {
                    body: "â° æ™‚é–“ã«ãªã£ãŸã‚ˆã€œï¼ãŠã¤ã‹ã‚Œã•ã¾ï¼",
                    icon: "https://cdn-icons-png.flaticon.com/512/864/864685.png" // æ±ç”¨çš„ãªæ™‚è¨ˆã‚¢ã‚¤ã‚³ãƒ³
                });
            }
        }

        function playAlarmSound() {
            if (!soundCheck.checked || !audioCtx) return;
            try {
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                oscillator.frequency.setValueAtTime(1760, audioCtx.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime + 0.4);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.8);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.8);
            } catch (e) { console.error(e); }
        }

        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.className = 'mt-8 p-4 rounded-xl text-center font-medium';
            if (isError) messageBox.classList.add('bg-red-100', 'text-red-700', 'block');
            else messageBox.classList.add('bg-purple-100', 'text-purple-700', 'block');
            setTimeout(() => { messageBox.classList.add('hidden'); }, 3000);
        }

        function updateDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.title = `${minutes}:${seconds.toString().padStart(2, '0')} - ãµã‚ã‚¿ã‚¤ãƒãƒ¼`; // ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–åã«ã‚‚æ™‚é–“ã‚’è¡¨ç¤º

            if (remainingTime <= 0 && isRunning) {
                stopTimer(true);
            }
        }

        function startTimer() {
            initAudio();
            requestNotificationPermission(); // ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚ã«é€šçŸ¥è¨±å¯ã‚’æ±‚ã‚ã‚‹

            if (isRunning && !isPaused) return;

            if (!isRunning) {
                const m = parseInt(minutesInput.value) || 0;
                const s = parseInt(secondsInput.value) || 0;
                remainingTime = m * 60 + s;
            }

            if (remainingTime <= 0) {
                showMessage('ã‚€ãã‚…ã€œï¼æ™‚é–“ã‚’ã‚»ãƒƒãƒˆã—ã¦ã­ï¼', true);
                return;
            }

            isRunning = true;
            isPaused = false;
            
            startButton.disabled = true;
            pauseButton.disabled = false;
            pauseButton.classList.remove('opacity-50', 'pointer-events-none');
            inputArea.classList.add('hidden');
            showMessage('ğŸš€ ã‚¹ã‚¿ãƒ¼ãƒˆï¼');

            intervalId = setInterval(() => {
                remainingTime--;
                updateDisplay();
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning || isPaused) return;
            clearInterval(intervalId);
            intervalId = null;
            isRunning = true;
            isPaused = true;
            startButton.disabled = false;
            pauseButton.disabled = true;
            pauseButton.classList.add('opacity-50', 'pointer-events-none');
            showMessage('â¸ï¸ ä¸€æ™‚åœæ­¢');
        }

        function stopTimer(finished = false) {
            if (intervalId) clearInterval(intervalId);
            intervalId = null;
            isRunning = false;
            isPaused = false;
            
            startButton.disabled = false;
            pauseButton.disabled = true;
            pauseButton.classList.add('opacity-50', 'pointer-events-none');
            inputArea.classList.remove('hidden');

            document.title = "ãµã‚ã‚¿ã‚¤ãƒãƒ¼ ğŸ’–"; // ã‚¿ãƒ–åã‚’æˆ»ã™

            if (finished) {
                remainingTime = 0;
                updateDisplay(); 
                playAlarmSound(); 
                showNotification(); // ã“ã“ã§é€šçŸ¥ã‚’å‡ºã™ï¼
                showMessage('ğŸ‰ æ™‚é–“ã«ãªã‚Šã¾ã—ãŸï¼');
                setTimeout(() => { alert("â° æ™‚é–“ã«ãªã‚Šã¾ã—ãŸï¼"); }, 100);
            } else {
                remainingTime = 0;
                updateDisplay();
                minutesInput.value = 0;
                secondsInput.value = 0;
                showMessage('ğŸ”„ ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        }

        startButton.addEventListener('click', startTimer);
        pauseButton.addEventListener('click', pauseTimer);
        resetButton.addEventListener('click', () => stopTimer(false));

        updateDisplay();
    </script>
</body>
</html>
